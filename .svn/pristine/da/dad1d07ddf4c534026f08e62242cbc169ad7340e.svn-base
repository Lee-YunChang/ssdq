<%@ page contentType="text/html; charset=utf-8" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
<html>
	<head>
	<meta charset="UTF-8">
	<c:import url="/common/pageLink.do?link=/mngr/cmmn/inc/header_inc" />
	</head>
	<body id="page-top">

		<div id="wrapper">
			<c:import url="/common/pageLink.do?link=/mngr/cmmn/inc/left_inc" />
			<!-- Content Wrapper -->
			<div id="content-wrapper" class="d-flex flex-column">
				<!-- 메인 -->
				<div id="content">
				<!-- 상단영역 -->
				<c:import url="/common/pageLink.do?link=/mngr/cmmn/inc/top_inc" />
					<!-- 본문 -->
					<div class="container-fluid l_position_parent">
						<!-- 상단 내비 / 타이틀 -->
						<div class="d-sm-flex align-items-center justify-content-between mgn_b0">
							<span class="col_gray01 font_14 mgn_b0"><img src="/resources/img/icon/icon_home.png" alt="집 아이콘" class="vtc_unset"> PROFILING &gt; 프로파일링 분석</span>
						</div>
						<div class="d-sm-flex align-items-center justify-content-between mb-4">
							<h1 class="col_grey font_23 font_slim" style="color: gray; font-weight: 100;">프로파일링 분석</h1>
						</div>
						<!-- 영역 -->
						<div class="row">
							<div class="col-lg mb-4">
								<div class="card shadow mb-4">
									<div class="input_table">
										<table>
											<caption></caption>
											<colgroup>
												<col style="width:20%">
												<col style="width:25%">
												<col style="width:10%">
												<col style="width:25%">
												<col style="width:20%">
											</colgroup>
											<tbody>
												<tr>
													<th><label for="data"><span class="str">*</span> 스키마명</label></th>
													<td>
														<select id="schemaName" name="schemaName" onchange="fn_changeSchema()">
															<option value="">스키마 선택</option>
														</select>
													</td>
													<th><label for="name"><span class="str">*</span> 테이블명</label></th>
													<td>
														<select id="tableName" name="tableName">
															<option value="">테이블 선택</option>
														</select>
													</td>
													<td></td>
												</tr>
											</tbody>
										</table>
									</div>
									<div style="text-align: center; padding: 10px;">
										<button class='btn btn-primary wd_50' type="button" onclick="showPop()" style="width:150px;">컬럼선택</button>
									</div>
								</div>
								
								
								<div class="card shadow mb-4">
									<div class="card-body">
										<div id="grid" class="tb_type99"></div>
									</div>
								</div>
								
								
								
							</div>
						</div>
					</div>
				</div>
				<!-- 풋터 -->
				<c:import url="/common/pageLink.do?link=/mngr/cmmn/inc/footer_inc" />
			</div>
		</div>${DDId}
	</body>

<script type="text/javascript" class="code-js">
$(function() {

	if(sessionCon == ''){
		alert('진단대상 데이터베이스 설정이 안되어 있습니다.\n\n 설정페이지로 이동합니다.');
		location.href = "/mngr/basicInfo/dgnssDbmsList";
		return false;
	}
	/* chosen Select Box 관련 추가  */
	/* 2019-07-29 최보람 */
	$("#schemaName, #tableName").chosen({
		search_contains : true,
		no_results_text : "검색결과가 없습니다. : "
	});
	
	/*추가*/
	fn_selectSchema();
});

/*추가*/
function fn_selectSchema(){

	$.post('selectSchemaListAjax.do', {
	}, function(list) {
		for (var i in list) {
			$('#schemaName').append($('<option />').val(list[i].OWNER).text(list[i].OWNER));
			
			/* 데이터 연결 후 option 생성 시 마다 update를 해 주어야 chosen이 작동함 */
			$("#schemaName").trigger("chosen:updated");
		}
//		$('#schemaName').val('DQSYS');
		fn_changeSchema();
	});
}

function fn_changeSchema(){

	$('#tableName').empty();
	$('#tableName').append($('<option />').val('').text('테이블 선택'));

	$.post('selectTableListAjax.do', {
		schemaName: $('#schemaName').val()
	}, function(list) {
		for (var i in list) {
			$('#tableName').append($('<option />').val(list[i]).text(list[i]));
			
			/* 데이터 연결 후 option 생성 시 마다 update를 해 주어야 chosen이 작동함 */
			$("#tableName").trigger("chosen:updated");
		}
	});
}

function showPop() {

	var schemaName = $("#schemaName").val();
	var tableName = $('#tableName').val();

	if (tableName == '') {
		alert('테이블을 선택해 주세요.');
		return;
	}

	window.open('popup/selectColumn.do?schemaName=' + schemaName + '&tableName=' + tableName, 'selectColumn', 'width=1265,height=700, left=300,top=210');
}

</script>

</html>