<%@ page language="java" contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<c:import url="/common/pageLink.do?link=/mngr/cmmn/inc/header_inc" />

		<title>Insert title here</title>
		
		<script type="text/javascript"  class="code-js">
			$(document).ready(function() {
				var dbmsKnd = "${dbmsKnd}";
				if(dbmsKnd == ""){
					dbmsKnd = "00";
				}
				
				selDbmsKindListBox(dbmsKnd);
			});

			// db종류 조회
			function selDbmsKindListBox(dbmsKnd){
				$.ajax({
					url: '/mngr/basicInfo/selDbmsKindList',
					method : 'POST',
					success: function(dataList){
						for(var i = 0; i < dataList.length; i++){
							var selected = "";
							if(dbmsKnd == dataList[i].dbmsKnd) {
								selected = "selected=true";
							}else{
								selected = "";
							}
							var option  = $("<option value="+dataList[i].dbmsKnd+" "+selected+">"+dataList[i].dbmsKnd+"</option>");
							$("#dbmsKnd").append(option);

						}
			        },
			    });

			}
			
			function showPop(){
				window.open("/mngr/basicInfo/csvFileData.do","addFile","width=600, height=400,left=100,top=50");
			}

			function doSave(evt) {
				var fileName = $("#fileName").val();
				var fileNames = fileName.split("\\");
				var len = fileNames.length -1;
				var checkNms = fileNames[len].split(".");
				var checkNm = checkNms[0].trim();
				var checkDns = checkNms[1].trim();
				// 업로드 파일 확인
				if(fileName == "") {
					alert("업로드할 파일을 선택해주세요");
					return false;
				}
				if ((new RegExp(/[^a-z0-9_]/gi)).test(checkNm)) {
					alert("파일명은 영문자/숫자 조합만 가능 합니다."); 
					return false;
				}
				if ((new RegExp(/^[(csv)]/gi)).test(checkDns.toLowerCase())== false) {
					alert("확장자 명이 csv 파일만 등록 가능합니다.");
					return false;
				}
				/* 로딩 이미지 호출 예제
				wrapWindowByMask();
				setTimeout(function() { 
					closeWindowByMask();
				}, 2000);
			    return false;
				*/
				
				var frm = $('#frm');
				window.open("","addFile","width=600, height=600,left=100,top=50");
				frm.attr('target', "addFile");
				
				frm.submit();
				
			}

			function onChangeDb(){
				var dbmsKnd = $("#dbmsKnd").val();
				// 선택 초기
				if(dbmsKnd == "00"){
					location.href = "/mngr/basicInfo/csvFileAdd.do?dbmsKnd="+dbmsKnd;
				}
				// oracle
				if(dbmsKnd == "Oracle"){
					location.href = "/mngr/basicInfo/dataConnProp.do?dbmsKnd="+dbmsKnd;
				}
				// csv
				if(dbmsKnd == "CSV"){
					location.href = "/mngr/basicInfo/csvFileAdd.do?dbmsKnd="+dbmsKnd;
				}
				// maria
				if(dbmsKnd == "Maria"){
					location.href = "/mngr/basicInfo/dataConnProp.do?dbmsKnd="+dbmsKnd;
				}
			}


			function get(evt){
				var files = evt.target.files;

	            var file = files[0];
	            var fileName = file.name;
	            var fileSize = file.size;
				$("#fileFullPath").val(fileSize+ ' Byte'+' / '+fileName);
	            console.log(file);

			}

			function goList(type){
				location.href = "/mngr/basicInfo/dgnssDbmsList";
			}

		</script>
		<script type="text/javascript" src="/resources/js/common.js"></script>
	</head>
	<body id="page-top">
		<div id="wrapper">
			<c:import url="/common/pageLink.do?link=/mngr/cmmn/inc/left_inc" />
			<div id="content-wrapper" class="d-flex flex-column">
				<!-- 메인 -->
				<div id="content">
				
					<!-- 상단영역 -->
					<c:import url="/common/pageLink.do?link=/mngr/cmmn/inc/top_inc" />
				
					<!-- 본문 -->
	                <div class="container-fluid l_position_parent">
						
						<!-- 상단 내비 / 타이틀 -->
						<div class="d-sm-flex align-items-center justify-content-between mgn_b0">
                  			<span class="col_gray01 font_14 mgn_b0"><img src="/resources/img/icon/icon_home.png" alt="집 아이콘" class="vtc_unset"> BASIC &gt; 기본정보&gt; CSV파일등록</span>
	                    </div>
	                    
	                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
							<h1 class="col_grey font_23 font_slim"> CSV파일등록</h1>
							<!-- <h1 class="col_grey font_23 font_slim"></i> 진단대상 데이터베이스 연결 설정(CSV)</h1> -->
	                    </div>

						<div id="container_inner">
						    <div class="white_box">
						    
		                    <section class="mgn_b20 txt_right">
		                        <button class="btn btn-secondary btn_wd100" onclick="goList('list');">목록보기</button>
		                        <button class="btn btn-primary btn_wd100" onclick="doSave();">파일등록</button>
		                    </section>    
		                    <span style="">※ CSV 파일만 등록 가능합니다. 파일명은 영문/숫자만으로 되어 있어야 등록이 가능합니다.</span>
		                    <form name="frm" id="frm"  method="post" action="/mngr/basicInfo/csvFileData.do" enctype="multipart/form-data">
		                        <section class="l_box_type02">                                    
		                            <div class="tb_type03">
		                                <table>
		                                    <tbody>
		                                        <tr>
		                                            <th>DB종류</th>
		                                            <td style="text-align: left;">
		                                                <select id="dbmsKnd" name="dbmsKnd" style="width: 200px;" onchange="onChangeDb()">
					                                    <option value="00" >선택</option>
					                                </select>                                                              
		                                            </td>
		                                        </tr>
		                                        <tr>
		                                            <th>파일 업로드</th>
		                                            <td>
		                                                <div class="filebox bs3-primary" style="text-align: left;">
		                                                    <input id="fileFullPath" name="fileFullPath" class="upload-name in_box_type01 in_length400" value="파일선택" style="width: 300px;" disabled="disabled">
		                                                    <label for="fileName" class="mgn_b0">파일 선택</label>
		                                                    <input type="file" name="fileName" id="fileName" class="upload-hidden" onchange="get(event);"> 
		                                                </div>
		                                            </td>
		                                        </tr>                                                                                                   
		                                    </tbody>
		                                </table>
		                            </div>
		                        </section>
		                       
		                    </form>
		                    
		                    </div>
		                </div>
					</div>
				</div>
				<!-- 풋터 -->
				<c:import url="/common/pageLink.do?link=/mngr/cmmn/inc/footer_inc" />
			</div>
			<!-- Content Wrapper -->
			
			
			
			<!-- Scroll to Top Button-->
			<a class="scroll-to-top rounded" href="#page-top">
				<i class="fas fa-angle-up"></i>
			</a>
			
			<!-- Logout Modal-->
			<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
							<button class="close" type="button" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">×</span>
							</button>
						</div>
			        	<div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
						<div class="modal-footer">
							<button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
							<a class="btn btn-primary" href="login.html">Logout</a>
			        	</div>
					</div>
				</div>
			</div>
		</div>
 	
	</body>
	
</html>